#!/bin/bash

# Ansible generated file. Do NOT edit.

set -e

# Default logging is to syslog but this can be overridden for testing
 
log="logger -i -t \"upssched-cmd\"" 
case "${1}" in
  "-log_none")
    log=":"
    shift
    ;;
  "-log_local")
    log="echo"
    shift
    ;;
  "-log_system")
    shift
    ;;
  *)
    ;;
esac

function handle_heartbeat_event() {
  case "${2}" in
    {% for e in nut_execute %}{{e}}{{ "|" if not loop.last else "" }}{% endfor %})
      ${log} "Heartbeat Event: ${1} ${2}."
      ;;
    *)
      ${log} "Unsupported event \"${2}\"."
      ;;
  esac
}

case "${1}" in
{% for h in groups['nut_server'] %}
{%   for d in hostvars[h]['ups_devices'] %}
  "ups-{{ loop.index }}@{{ h }}")
    case "${2}" in
{%     for e in nut_execute %}
      {{ e }})
        ${log} "Handling: ups-{{ loop.index }}@{{ h }} {{e}}."
        ;;
{%     endfor %}
      *)
        ${log} "Unsupported event \"${2}\"."
        ;;
      esac
    ;;
{%   endfor %}
{%   if heartbeat_enabled %}
  "ups-H@{{ h }}")
    handle_heartbeat_event "${1}" ${2}
    ;;
{%   endif %}
{% endfor %}
  *)
    ${log} "Unknown UPS device \"${1}\"."
    ;;
esac
